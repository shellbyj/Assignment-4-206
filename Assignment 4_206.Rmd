---
title: "Assignment 4"
author: "Shellby Johnson"
date: "November 15, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(kableExtra)
library(knitr)
library(vcdExtra)
library(dplyr)
library(car)
library(onewaytests)


lobster_size <- read_csv("lobster_size_abundance.csv") #frequency version of lobster size data
trap_counts <- read_csv("lobster_traps.csv")

#expanded lobster size data
lobster_tidy <- expand.dft(data.frame(lobster_size), freq = "COUNT")
```


```{r}

#total # of lobsters sampled at each site each year
totalcount_year <- lobster_size %>% 
  group_by(YEAR, SITE) %>% 
  summarize(total = sum(COUNT))

kable(totalcount_year)

#lobster abundanc
size_column <- ggplot(totalcount_year, aes(x = YEAR, y = total))+
  geom_point()+
  geom_line(aes(colour = SITE))
  

size_column

#total # of traps at each site each year (8 sites)
totalcount_traps <- trap_counts %>%
  filter(SITE != "AHND to AQUE", SITE != "ABUR", SITE != "AHND", SITE != "GOLB") %>% 
  group_by(YEAR, SITE) %>% 
  summarize(total = sum(TRAPS))

#traps line plots
traps_column <- ggplot(totalcount_traps, aes(x = YEAR, y = total))+
  geom_point()+
  geom_line(aes(colour = SITE))

traps_column
```


```{r}
#Need to do a test to compare means (lobster size) across all 5 LTER sites
# will do short exploratory data to look at distribution to see if it satisfies assumptions for parametric ANOVA test

lobster_size_hist <- ggplot(lobster_tidy, aes(x = SIZE)) + 
  geom_histogram( bins= 33, aes(fill= SITE))+
  facet_wrap(~ SITE, scale = "free")

lobster_size_hist

#distribution looks pretty normal across the sites

#Now on to equal variance test

summary_lobster <- lobster_tidy %>% 
  filter(YEAR == "2017") %>% 
  group_by(SITE) %>% 
  summarize(
    mean = mean(SIZE),
    sd = sd(SIZE),
    variance = var(SIZE)
  )
  
  summary_lobster
  
#We are now using levene's test for equal variances
  
lobster_levene <- leveneTest(SIZE ~ SITE, data = lobster_tidy)

lobster_levene

## Largest variance is <4x the smallest (refer to the "summary_lobster" df), so ANOVA can still be used even though levene's test says that they are unequal. 

```

```{r}

# ANOVA TEST

lobster_aov <- aov(mean ~ SITE, data = summary_lobster)
lobster_sum <- summary(lobster_aov)

lobster_aov

penguin_ph <- TukeyHSD(penguin_aov)
```

