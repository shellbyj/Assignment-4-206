---
title: "Assignment 4"
author: "Shellby Johnson"
date: "November 15, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(kableExtra)
library(knitr)
library(vcdExtra)
library(dplyr)
library(car)
library(onewaytests)


lobster_size <- read_csv("lobster_size_abundance.csv") #frequency version of lobster size data
trap_counts <- read_csv("lobster_traps.csv")

#expanded lobster size data
lobster_tidy <- expand.dft(data.frame(lobster_size), freq = "COUNT")
```


```{r}

#1. 
#total # of lobsters sampled at each site each year
totalcount_year <- lobster_size %>% 
  group_by(YEAR, SITE) %>% 
  summarize(total = sum(COUNT))

kable(totalcount_year)

#lobster abundanc
size_column <- ggplot(totalcount_year, aes(x = YEAR, y = total))+
  geom_point()+
  geom_line(aes(colour = SITE))
  

size_column

#total # of traps at each site each year (8 sites)
totalcount_traps <- trap_counts %>%
  filter(SITE != "AHND to AQUE", SITE != "ABUR", SITE != "AHND", SITE != "GOLB") %>% 
  group_by(YEAR, SITE) %>% 
  summarize(total = sum(TRAPS))

#traps line plots
traps_column <- ggplot(totalcount_traps, aes(x = YEAR, y = total))+
  geom_point()+
  geom_line(aes(colour = SITE))

traps_column
```


```{r}
#Need to do a test to compare means (lobster size) across all 5 LTER sites
# will do short exploratory data to look at distribution to see if it satisfies assumptions for parametric ANOVA test

lobster_size_hist <- ggplot(lobster_tidy, aes(x = SIZE)) + 
  geom_histogram( bins= 33, aes(fill= SITE))+
  facet_wrap(~ SITE, scale = "free")

lobster_size_hist

#distribution looks pretty normal across the sites

#Now on to equal variance test

summary_lobster <- lobster_tidy %>% 
  filter(YEAR == "2017") %>% 
  group_by(SITE) %>% 
  summarize(
    mean = mean(SIZE),
    sd = sd(SIZE),
    variance = var(SIZE)
  )
  
  summary_lobster
  
#We are now using levene's test for equal variances
  
lobster_levene <- leveneTest(SIZE ~ SITE, data = lobster_tidy)

lobster_levene

## Largest variance is <4x the smallest (refer to the "summary_lobster" df), so ANOVA can still be used even though levene's test says that they are unequal. 

```

```{r}

#2.  ANOVA TEST

lobster_aov <- aov(mean ~ SITE, data = summary_lobster)
lobster_sum <- summary(lobster_aov)

lobster_aov

```

```{r}
#3, Part 1

#Created data frames to use for unpaired t-tests, and created histograms to explore whether the data is normally distributed. Will also do F-tests to check for equal variance


IVEE_12_17<-lobster_tidy %>% 
  select(SITE, YEAR, SIZE) %>% 
  filter(SITE=="IVEE", YEAR=="2012"|YEAR=="2017")
  
IVEE_12_17

IVEE_1217_hist<-ggplot(IVEE_12_17, aes(x=SIZE))+
  geom_histogram()+
  facet_wrap(~YEAR, scale="free")
  
IVEE_1217_hist

F_test_1<-IVEE_12_17 %>% 
  var.test(SIZE~YEAR, data=.)

F_test_1  #p-value=0.307 compare values to make sure it is correct
#####################################################################################

NAPL_12_17<-lobster_tidy %>% 
  select(SITE, YEAR, SIZE) %>% 
  filter(SITE=="NAPL", YEAR=="2012"|YEAR=="2017")
  
NAPL_12_17


NAPL_1217_hist<-ggplot(NAPL_12_17, aes(x=SIZE))+
  geom_histogram()+
  facet_wrap(~YEAR, scale="free")
  
NAPL_1217_hist

F_test_2<-NAPL_12_17 %>% 
  var.test(SIZE~YEAR, data=.)

F_test_2  #p-value=0.7685

######################################################################################

AQUE_12_17<-lobster_tidy %>% 
  select(SITE, YEAR, SIZE) %>% 
  filter(SITE=="AQUE", YEAR=="2012"|YEAR=="2017")

AQUE_12_17


AQUE_1217_hist<-ggplot(AQUE_12_17, aes(x=SIZE))+
  geom_histogram()+
  facet_wrap(~YEAR, scale="free")
  
AQUE_1217_hist

F_test_3<-AQUE_12_17 %>% 
  var.test(SIZE~YEAR, data=.)

F_test_3  #p-value=0.2986

######################################################################################

CARP_12_17<-lobster_tidy %>% 
  select(SITE, YEAR, SIZE) %>% 
  filter(SITE=="CARP", YEAR=="2012"|YEAR=="2017")

CARP_12_17


CARP_1217_hist<-ggplot(CARP_12_17, aes(x=SIZE))+
  geom_histogram()+
  facet_wrap(~YEAR, scale="free")
  
CARP_1217_hist

F_test_4<-CARP_12_17 %>% 
  var.test(SIZE~YEAR, data=.)

F_test_4  #p-value=0.2043

#######################################################################################

MOHK_12_17<-lobster_tidy %>% 
  select(SITE, YEAR, SIZE) %>% 
  filter(SITE=="MOHK", YEAR=="2012"|YEAR=="2017")

MOHK_12_17

MOHK_1217_hist<-ggplot(MOHK_12_17, aes(x=SIZE))+
  geom_histogram()+
  facet_wrap(~YEAR, scale="free")
  
MOHK_1217_hist

F_test_5<-MOHK_12_17 %>% 
  var.test(SIZE~YEAR, data=.)

F_test_5  #p-value=0.1509


#I REACH THE CONCLUSION THAT VARIANCES BETWEEN 2012 & 2017 SAMPLES, AT ALL SITES, ARE EQUAL


```


```{r}
#3, Part 2

#Will do unpaired t-tests to compare lobster sizes between 2012 and 2017 at each of the 5 sites. Did unpaired because there was not a 1-to-1 ratio in data.

ivee_12<-IVEE_12_17 %>%
  filter(YEAR=="2012") %>% 
  pull(SIZE)

ivee_12

ivee_17<-IVEE_12_17 %>%
  filter(YEAR=="2017") %>% 
  pull(SIZE)

ivee_17


ivee_unpaired_t<-t.test(ivee_12, ivee_17, var.equal = TRUE)
ivee_unpaired_t  #p-value=0.0361, but when I put var.equal = TRUE I get p=0.0599 compare to see if correct

ivee_unpaired_t<-t.test(ivee_12, ivee_17)
ivee_unpaired_t  #p-value=0.0361, compare to see if correct



#########################################################################################

napl_12<-NAPL_12_17 %>%
  filter(YEAR=="2012") %>% 
  pull(SIZE)

napl_12

napl_17<-NAPL_12_17 %>%
  filter(YEAR=="2017") %>% 
  pull(SIZE)

napl_17


napl_unpaired_t<-t.test(napl_12, napl_17, var.equal = TRUE)
napl_unpaired_t  #p-value=0.5373 or p=0.5002

napl_unpaired_t<-t.test(napl_12, napl_17)
napl_unpaired_t  #p-value=0.5373



#########################################################################################

aque_12<-AQUE_12_17 %>%
  filter(YEAR=="2012") %>% 
  pull(SIZE)

aque_12

aque_17<-AQUE_12_17 %>%
  filter(YEAR=="2017") %>% 
  pull(SIZE)

aque_17


aque_unpaired_t<-t.test(aque_12, aque_17, var.equal = TRUE)
aque_unpaired_t  #p-value=0.1907 or p=0.2097

aque_unpaired_t<-t.test(aque_12, aque_17)
aque_unpaired_t  #p-value=0.1907


#########################################################################################

carp_12<-CARP_12_17 %>%
  filter(YEAR=="2012") %>% 
  pull(SIZE)

carp_12

carp_17<-CARP_12_17 %>%
  filter(YEAR=="2017") %>% 
  pull(SIZE)

carp_17


carp_unpaired_t<-t.test(carp_12, carp_17, var.equal = TRUE)
carp_unpaired_t  #p-value=0.2211 or p=0.1819

carp_unpaired_t<-t.test(carp_12, carp_17)
carp_unpaired_t  #p-value=0.2211



#########################################################################################

mohk_12<-MOHK_12_17 %>%
  filter(YEAR=="2012") %>% 
  pull(SIZE)

mohk_12

mohk_17<-MOHK_12_17 %>%
  filter(YEAR=="2017") %>% 
  pull(SIZE)

mohk_17


mohk_unpaired_t<-t.test(mohk_12, mohk_17, var.equal = TRUE)
mohk_unpaired_t #p-value<0.001


```



```{r}
#4. 

#Will make table for # of lobsters at each site that are longer than 82.6 mm. Then I will do a chi-square test on this table.

lobster_83_up<-lobster_tidy %>% 
  mutate(
    size=ifelse(
      SIZE<83,"below_83", "above_83")
  )
  

lobster_83_up

table_83_up<-lobster_83_up %>% 
  count(SITE,size) %>% 
  spread(size, n) %>% 
  select(-SITE)

rownames(table_83_up)<-c("AQUE", "CARP", "IVEE", "MOHK", "NAPL")

table_83_up

######################################################################################
#Proportions table made

above_83_prop<-prop.table(as.matrix(table_83_up), 1)
above_83_prop

######################################################################################
#Performing chi-square

above_83_x2<-chisq.test(table_83_up)
above_83_x2  #p-value < 0.001, compare to make sure answer is correct

```

